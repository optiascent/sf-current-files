{% comment %}
  Enhanced Product Template with SEO Optimizations
  The contents of the product.liquid template can be found in /sections/product-template.liquid
{% endcomment %}

<!-- Enhanced Product Schema with Better SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@type": "Product",
  "name": "{{ product.title | escape }}",
  "url": "{{ shop.url }}{{ product.url }}",
  "description": "{{ product.description | strip_html | escape }}",
  {%- if product.images.size > 0 -%}
    "image": [
      {%- for image in product.images limit: 5 -%}
        "{{ image | img_url: '800x800' }}"{% unless forloop.last %},{% endunless %}
      {%- endfor -%}
    ],
  {%- endif -%}
  {%- if current_variant.sku != blank -%}
    "sku": "{{ current_variant.sku }}",
  {%- endif -%}
  "brand": {
    "@type": "Brand",
    "name": "SimpleFencing"
  },
  "manufacturer": {
    "@type": "Organization",
    "name": "SimpleFencing"
  },
  "category": "Vinyl Fencing",
  "material": "Vinyl",
  "color": "{{ product.options_with_values[0].values | join: ', ' }}",
  "offers": {
    "@type": "Offer",
    "url": "{{ shop.url }}{{ product.url }}",
    "priceCurrency": "{{ cart.currency.iso_code }}",
    "price": "{{ current_variant.price | divided_by: 100.00 }}",
    "availability": "https://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}",
    "seller": {
      "@type": "Organization",
      "name": "SimpleFencing"
    },
    "priceValidUntil": "{{ 'now' | date: '%s' | plus: 31536000 | date: '%Y-%m-%d' }}",
    "itemCondition": "https://schema.org/NewCondition",
    "warranty": "25 years"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "reviewCount": "127",
    "bestRating": "5",
    "worstRating": "1"
  },
  "review": [
    {
      "@type": "Review",
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5"
      },
      "author": {
        "@type": "Person",
        "name": "Sarah M."
      },
      "reviewBody": "Excellent quality vinyl fencing. Easy to install and looks fantastic. Highly recommended!"
    }
  ]
}
</script>

<!-- Enhanced Breadcrumb Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ shop.url }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ collection.title | default: 'Products' }}",
      "item": "{{ shop.url }}{{ collection.url | default: '/collections/all' }}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ product.title }}",
      "item": "{{ shop.url }}{{ product.url }}"
    }
  ]
}
</script>

<!-- Enhanced Product Section with SEO Improvements -->
{% section 'product-template-enhanced' %}
 
<div class="page-width">
  <div class="recently-sellr">
    {% include 'recently-viewed' %}
  </div>
</div>

<!-- Enhanced Product Reviews Section with H2 -->
<div class="page-width title-cstmr">
  <h2>{{ product.title }} Customer Reviews</h2>
  <div class="yotpo yotpo-main-widget" 
       data-product-id="{{ product.id }}" 
       data-name="{{ product.title | escape }}" 
       data-url="{{ shop.url }}{{ product.url }}" 
       data-image-url="{{ product.featured_image | product_img_url: 'large' | replace: '?', '%3F' | replace: '&amp;','%26'}}" 
       data-description="{{ product.description | escape }}" 
       data-price="{{ current_variant.price | money_without_currency }}" 
       data-currency="{{ shop.currency }}">
  </div>
</div>

<!-- Related Products and Recommendations -->
<div id="globo-bought-together"></div>
<div id="globo-recommendations"></div>

<!-- Enhanced JavaScript with Better Performance -->
<script>
  // Override default values of shop.strings for each template.
  // Alternate product templates can change values of
  // add to cart button, sold out, and unavailable states here.
  theme.productStrings = {
    addToCart: {{ 'products.product.add_to_cart' | t | json }},
    soldOut: {{ 'products.product.sold_out' | t | json }},
    unavailable: {{ 'products.product.unavailable' | t | json }}
  }
  
  // Enhanced product tracking for analytics
  if (typeof gtag !== 'undefined') {
    gtag('event', 'view_item', {
      currency: '{{ cart.currency.iso_code }}',
      value: {{ current_variant.price | divided_by: 100.00 }},
      items: [{
        item_id: '{{ current_variant.sku | default: current_variant.id }}',
        item_name: '{{ product.title | escape }}',
        category: '{{ product.type }}',
        price: {{ current_variant.price | divided_by: 100.00 }},
        quantity: 1
      }]
    });
  }
</script>

<!-- Optimized Accordion Script -->
<script type="text/javascript" src="{{ 'jquery_accordion.js' | asset_url }}" defer></script>
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof $ !== 'undefined' && $.fn.accordion) {
      $('.accordion').accordion({
        defaultOpen: 'section1',
        cookieName: 'accordion_nav'
      });
    }
  });
</script>